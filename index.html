<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>フードログ｜ログイン画面</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
    transition: background 0.5s, color 0.5s;
  }
  .container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .login-box {
    background: rgba(255,255,255,0.9);
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 450px;
    text-align: center;
    transition: background 0.5s;
  }
  .login-box h1 { margin-bottom: 25px; }
  input {
    width: 80%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 6px;
    border: 1px solid #aaa;
    font-size: 1rem;
  }
  button {
    padding: 10px 20px;
    font-size: 1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin: 10px;
  }
  .tab {
    margin-bottom: 15px;
  }
  .tab button {
    width: 40%;
    font-weight: bold;
  }
  .active {
    background: orange;
    color: white;
  }
  body.night { background: #121212; color: #e0f7ff; }
  body.night .login-box { background: rgba(30,30,30,0.9); }
  body.night input { background: #222; color: #e0f7ff; border: 1px solid #666; }
  body.night button.active { background: #00aaff; color: white; }
</style>
</head>
<body>
<div class="container">
  <div class="login-box">
    <h1>フードログ｜ログイン画面</h1>
    <div class="tab">
      <button id="loginTab" class="active" onclick="switchTab('login')">ログイン</button>
      <button id="registerTab" onclick="switchTab('register')">新規登録</button>
    </div>

    <!-- ログインフォーム -->
    <div id="loginForm">
      <input id="loginUser" placeholder="ユーザー名"><br>
      <input id="loginPass" type="password" placeholder="パスワード"><br>
      <button onclick="login()">ログイン</button>
    </div>

    <!-- 登録フォーム -->
    <div id="registerForm" style="display:none;">
      <input id="regUser" placeholder="ユーザー名"><br>
      <input id="regPass" type="password" placeholder="パスワード"><br>
      <button onclick="register()">登録</button>
    </div>

    <p id="msg" style="color:red;"></p>
  </div>
</div>

<script>
// === テーマ自動切替 ===
function applyTheme() {
  const hour = new Date().getHours();
  document.body.classList.toggle('night', hour < 5 || hour > 18);
}
applyTheme();

// === タブ切替 ===
function switchTab(tab) {
  const loginTab = document.getElementById('loginTab');
  const registerTab = document.getElementById('registerTab');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  if (tab === 'login') {
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    loginTab.classList.add('active');
    registerTab.classList.remove('active');
  } else {
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    loginTab.classList.remove('active');
    registerTab.classList.add('active');
  }
}

// === ログイン処理 ===
async function login() {
  const user = document.getElementById("loginUser").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  const msg = document.getElementById("msg");
  msg.textContent = "";

  if (!user || !pass) {
    msg.textContent = "未入力があります。";
    return;
  }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username: user, password: pass })
    });
    const data = await res.json();
    if (data.ok) {
      alert("ログイン成功！");
      window.location.href = "main.html";
    } else {
      msg.textContent = data.error || "ログインに失敗しました。";
    }
  } catch (e) {
    msg.textContent = "通信エラーが発生しました。";
  }
}

// === 新規登録処理 ===
async function register() {
  const user = document.getElementById("regUser").value.trim();
  const pass = document.getElementById("regPass").value.trim();
  const msg = document.getElementById("msg");
  msg.textContent = "";

  if (!user || !pass) {
    msg.textContent = "未入力があります。";
    return;
  }

  try {
    const res = await fetch("/api/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username: user, password: pass })
    });
    const data = await res.json();
    if (data.ok) {
      alert("登録完了しました！");
      switchTab('login');
    } else {
      msg.textContent = data.error || "登録に失敗しました。";
    }
  } catch (e) {
    msg.textContent = "通信エラーが発生しました。";
  }
}
</script>
</body>
</html>
