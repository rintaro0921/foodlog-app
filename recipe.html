<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>フードログ｜AIレシピ提案</title>
<style>
  body { font-family: "Segoe UI", sans-serif; margin: 0; background: #fff5e6; }
  header { background: orange; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
  header button { background: white; color: orange; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-weight: bold; }
  main { max-width: 700px; margin: 40px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  h2 { text-align: center; }
  input, select { width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ccc; border-radius: 6px; }
  button { margin-top: 10px; background: orange; color: white; border: none; padding: 10px 14px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; }
  pre { background: #f4f4f4; padding: 10px; border-radius: 6px; white-space: pre-wrap; }
  .error { color: red; text-align: center; margin-top: 10px; }
</style>
</head>
<body>
<header>
  <h1>フードログ｜AIレシピ提案</h1>
  <button onclick="location.href='main.html'">メインに戻る</button>
</header>

<main>
  <h2>使いたい食材を入力してください</h2>
  <input id="ingredients" placeholder="例：鶏もも肉、白菜、トマト">
  <label for="style">料理スタイルを選択:</label>
  <select id="style">
    <option value="washoku">和食</option>
    <option value="yoshoku">洋食</option>
    <option value="chuka">中華</option>
    <option value="italian">イタリアン</option>
    <option value="soup">スープ</option>
    <option value="stirfry">炒め物</option>
    <option value="nimono">煮込み</option>
    <option value="agemono">揚げ物</option>
  </select>
  <button onclick="getRecipe()">レシピ提案</button>
  <div id="result"></div>
  <p class="error" id="error"></p>
</main>

<script>
async function getRecipe() {
  const ingredients = document.getElementById("ingredients").value.trim();
  const style = document.getElementById("style").value;
  const resultDiv = document.getElementById("result");
  const errorP = document.getElementById("error");
  resultDiv.innerHTML = "";
  errorP.textContent = "";

  if (!ingredients) {
    errorP.textContent = "食材を入力してください。";
    return;
  }

  resultDiv.innerHTML = "<p>AIがレシピを考えています...</p>";

  try {
    const res = await fetch("/api/recipe", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ingredients: ingredients.split(/[、,]/), style })
    });

    const data = await res.json();
    if (!data.ok) throw new Error(data.error);

    const r = data.recipe;
    resultDiv.innerHTML = `
      <h3>${r.title}</h3>
      <p><strong>材料：</strong>${r.ingredients.join("、")}</p>
      <h4>作り方：</h4>
      <ol>${r.steps.map(s => `<li>${s}</li>`).join("")}</ol>
      <h4>ポイント：</h4>
      <ul>${r.tips.map(t => `<li>${t}</li>`).join("")}</ul>
    `;
  } catch (err) {
    console.error(err);
    errorP.textContent = "レシピ生成に失敗しました。";
  }
}
</script>
</body>
</html>
